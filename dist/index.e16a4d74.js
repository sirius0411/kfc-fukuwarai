(()=>{"use strict";var e,t,n,s,i,a,r,o={138:(e,t,n)=>{n.a(e,(async e=>{var t=n(690),s=e([t]);t=(s.then?await s:s)[0];const i="https://cdn.jsdelivr.net/gh/sirius0411/kfc-fukuwarai/dist/",a=t.Sprite,r="idle",o="item",c="end",d=Math.min(window.innerWidth,512),m=d/512;console.log(`global scale ratio ${m}`);const l=new t.Application({width:d,height:d,antialias:!0,backgroundColor:16777215});document.getElementById("canvasContainer").appendChild(l.view);const g=t.Loader.shared,h={},u={kmr:{full:"assets/kmr/avatar.png",face:"assets/kmr/face.png",widgets:[{name:"eye-l",hint:"move left eye",src:"assets/kmr/eye-l.png"},{name:"hairpin",hint:"move hairpin",src:"assets/kmr/hairpin.png"},{name:"eyebow-l",hint:"move left eyebow",src:"assets/kmr/eyebow-l.png"},{name:"nose",hint:"move nose",src:"assets/kmr/nose.png"},{name:"mouth2",hint:"move mouth",src:"assets/kmr/mouth2.png"},{name:"eye-r",hint:"move right eye",src:"assets/kmr/eye-r.png"},{name:"rouge-r",hint:"move right rouge",src:"assets/kmr/rouge-r.png"},{name:"nevus",hint:"move nevus",src:"assets/kmr/nevus.png"},{name:"mouth4",hint:"move mouth",src:"assets/kmr/mouth4.png"},{name:"ring",hint:"move ring",src:"assets/kmr/ring.png"},{name:"rouge-l",hint:"move left rouge",src:"assets/kmr/rouge-l.png"},{name:"eyebow-r",hint:"move right eyebow",src:"assets/kmr/eyebow-r.png"}]},kmr1:{full:"assets/kmr/avatar.png",face:"assets/kmr/face.png",widgets:[{name:"eye-l",hint:"move left eye",src:"assets/kmr/eye-l.png"},{name:"eye-r",hint:"move right eye",src:"assets/kmr/eye-r.png"},{name:"eyebow-l",hint:"move left eyebow",src:"assets/kmr/eyebow-l.png"},{name:"eyebow-r",hint:"move right eyebow",src:"assets/kmr/eyebow-r.png"},{name:"nose",hint:"move nose",src:"assets/kmr/nose.png"},{name:"mouth",hint:"move mouth",src:"assets/kmr/mouth2.png"},{name:"nevus",hint:"move nevus",src:"assets/kmr/nevus.png"},{name:"hairpin",hint:"move hairpin",src:"assets/kmr/hairpin.png"},{name:"ring",hint:"move ring",src:"assets/kmr/ring.png"}]},kmr2:{full:"assets/kmr/avatar.png",face:"assets/kmr/face.png",widgets:[{name:"eye-l",hint:"move left eye",src:"assets/kmr/eye-l.png"},{name:"eye-r",hint:"move right eye",src:"assets/kmr/eye-r.png"},{name:"eyebow-l",hint:"move left eyebow",src:"assets/kmr/eyebow-l.png"},{name:"eyebow-r",hint:"move right eyebow",src:"assets/kmr/eyebow-r.png"},{name:"nose",hint:"move nose",src:"assets/kmr/nose.png"},{name:"mouth",hint:"move mouth",src:"assets/kmr/mouth3.png"},{name:"nevus",hint:"move nevus",src:"assets/kmr/nevus.png"},{name:"hairpin",hint:"move hairpin",src:"assets/kmr/hairpin.png"},{name:"ring",hint:"move ring",src:"assets/kmr/ring.png"}]}},f=e=>{const t=document.querySelector(".form-check-input:checked").id;console.log(`selected id ${t}`),p=u[t],w.reset(),k(w.config)};for(let e of document.getElementsByClassName("form-check-input"))e.addEventListener("click",f);let p=u.kmr;function v(){return p}let w={state:r,config:v(),data:{index:0,widgetStates:{}},reset:function(){const e=this;e.state=r,e.config=v(),e.data={index:0,widgetStates:{}},l.stage.removeChildren(0,l.stage.children.length)}};function k(e){g.reset(),g.add(i+e.full).add(i+e.face);for(let t of e.widgets)g.add(i+t.src);g.load(((t,n)=>{!function(e,t){h.full=new a(e[i+t.full].texture),h.full.scale.set(m,m),l.stage.addChild(h.full),h.face=new a(e[i+t.face].texture),h.face.visible=!1,h.face.scale.set(m,m),l.stage.addChild(h.face),h.widgets=[];for(let n of t.widgets){const t=new a(e[i+n.src].texture);t.name=n.name,t.visible=!1,t.interactive=!0,t.buttonMode=!0,t.anchor.set(.5),t.x=t.width/2,t.y=t.height/2,t.on("mousedown",_).on("touchstart",_).on("mouseup",C).on("mouseupoutside",C).on("touchend",C).on("touchendoutside",C).on("mousemove",P).on("touchmove",P),y(t),h.widgets.push(t),l.stage.addChild(t)}x("Ready?"),E("Start"),l.ticker.add((e=>function(){switch(w.state){case r:I.hidden=!0;for(let e of l.stage.children)e===h.full?h.full.visible||(h.full.visible=!0):e.visible=!1;break;case o:I.hidden=!1;const e=h.widgets[w.data.index];e.interactive=!0;for(let t of l.stage.children)t===e?0==t.visible&&(t.visible=!0):t.visible=!1;break;case c:I.hidden=!0;for(let e of l.stage.children)e===h.full?e.visible=!1:(e.name?"done"==w.data.widgetStates[e.name]?e.visible=!0:e.visible=!1:e.visible=!0,e.interactive=!1)}}()))}(n,e)}))}function y(e){e.anchor.set(.5),e.scale.set(m,m)}k(w.config);const b=document.getElementById("hint");function x(e){b.innerText=e}const S=document.getElementById("action");function E(e){S.innerText=e}S.addEventListener("click",(e=>{switch(w.state){case r:w.state=o,w.data.index=0,w.data.widgetStates={},E("Next"),x(w.config.widgets[0].hint);break;case o:const t=w.config.widgets[w.data.index].name;if(w.data.widgetStates[t]||(w.data.widgetStates[t]="done"),"Finish"==e.target.innerText)return w.state=c,E("Restart"),void x("");const n=w.data.index+1;n>=w.config.widgets.length?(w.state=c,E("Restart"),x("")):(n==w.config.widgets.length-1&&E("Finish"),w.data.index=n,x(w.config.widgets[n].hint));break;case c:w.state=r,E("Start"),x("Ready?");for(let e of l.stage.children)e!==h.face&&e!==h.full&&(e.x=e.width/2,e.y=e.height/2)}}));const I=document.getElementById("skip");function _(e){this.data=e.data,this.alpha=.5,this.dragging=!0}function C(){this.alpha=1,this.dragging=!1,this.data=null}function P(){if(this.dragging){var e=this.data.getLocalPosition(this.parent);this.position.x=e.x,this.position.y=e.y}}I.addEventListener("click",(e=>{const t=w.config.widgets[w.data.index].name;w.data.widgetStates[t]="skip";let n=w.data.index+1;if(n>=w.config.widgets.length)for(let e=0;e<w.config.widgets.length;e++){const t=w.config.widgets[e].name;if(!w.data.widgetStates[t]||"skip"==w.data.widgetStates[t]){n=e;break}}console.log(`skip next index ${n}`),n>=w.config.widgets.length?I.hidden=!0:(n==w.config.widgets.length-1&&E("Finish"),w.data.index=n,x(w.config.widgets[n].hint))}))}))},690:(e,t,n)=>{var s=new Error;e.exports=new Promise(((e,t)=>{if("undefined"!=typeof PIXI)return e();n.l("https://cdn.jsdelivr.net/npm/pixi.js@5.3.7/dist/pixi.min.js",(n=>{if("undefined"!=typeof PIXI)return e();var i=n&&("load"===n.type?"missing":n.type),a=n&&n.target&&n.target.src;s.message="Loading script failed.\n("+i+": "+a+")",s.name="ScriptExternalLoadError",s.type=i,s.request=a,t(s)}),"PIXI")})).then((()=>PIXI))}},c={};function d(e){if(c[e])return c[e].exports;var t=c[e]={exports:{}};return o[e](t,t.exports,d),t.exports}e="function"==typeof Symbol?Symbol("webpack then"):"__webpack_then__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n=e=>{e&&(e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},s=e=>!--e.r&&e(),i=(e,t)=>e?e.push(t):s(t),d.a=(a,r,o)=>{var c,d,m,l=o&&[],g=a.exports,h=!0,u=!1,f=(t,n,s)=>{u||(u=!0,n.r+=t.length,t.map(((t,i)=>{t[e](n,s)})),u=!1)},p=new Promise(((e,t)=>{m=t,d=()=>{e(g),n(l),l=0}}));p[t]=g,p[e]=(e,t)=>{if(h)return s(e);c&&f(c,e,t),i(l,e),p.catch(t)},a.exports=p,r((a=>{if(!a)return d();var r,o;c=(a=>a.map((a=>{if(null!==a&&"object"==typeof a){if(a[e])return a;if(a.then){var r=[];a.then((e=>{o[t]=e,n(r),r=0}));var o={[e]:(e,t)=>{i(r,e),a.catch(t)}};return o}}return{[e]:e=>{s(e)},[t]:a}})))(a);var m=new Promise(((e,n)=>{(r=()=>e(o=c.map((e=>e[t])))).r=0,f(c,r,n)}));return r.r?m:o})).then(d,m),h=!1},d.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return d.d(t,{a:t}),t},d.d=(e,t)=>{for(var n in t)d.o(t,n)&&!d.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},d.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a={},r="komowarai:",d.l=(e,t,n,s)=>{if(a[e])a[e].push(t);else{var i,o;if(void 0!==n)for(var c=document.getElementsByTagName("script"),m=0;m<c.length;m++){var l=c[m];if(l.getAttribute("src")==e||l.getAttribute("data-webpack")==r+n){i=l;break}}i||(o=!0,(i=document.createElement("script")).charset="utf-8",i.timeout=120,d.nc&&i.setAttribute("nonce",d.nc),i.setAttribute("data-webpack",r+n),i.src=e),a[e]=[t];var g=(t,n)=>{i.onerror=i.onload=null,clearTimeout(h);var s=a[e];if(delete a[e],i.parentNode&&i.parentNode.removeChild(i),s&&s.forEach((e=>e(n))),t)return t(n)},h=setTimeout(g.bind(null,void 0,{type:"timeout",target:i}),12e4);i.onerror=g.bind(null,i.onerror),i.onload=g.bind(null,i.onload),o&&document.head.appendChild(i)}},d(138)})();